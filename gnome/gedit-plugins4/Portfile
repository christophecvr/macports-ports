# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           meson 1.0

name                gedit-plugins4
set my_name         gedit-plugins
version             48.1
revision            1
license             GPL-2+
set branch          [join [lrange [split ${version} .] 0 0] .]
description         Plug-ins for GEdit
long_description    Various additional plug-ins for GEdit
maintainers         nomaintainer
categories          gnome editors
homepage            https://gedit-technology.github.io/apps/gedit/
fetch.type          git
git.url             https://gitlab.gnome.org/christophecvr/${my_name}.git
git.branch          origin/geditcvr

#master_sites        https://download.gnome.org/sources/${my_name}/${branch}/ \
#                    gnome:sources/${my_name}/${branch}/

#distname            ${my_name}-${version}

#use_xz              yes

checksums           rmd160  d569a8e0dbfc5986617b12a490416776fa09de92 \
                    sha256  9026bfe71a678f8c47f46316837437e7b357918fd6c3d4d65be27fc95b710e1c \
                    size    881140

depends_build-append \
                    port:pkgconfig \
                    port:appstream-glib \
                    port:gettext \
                    port:cctools \
                    port:itstool

depends_lib         port:gedit4 \
                    port:gettext \
                    port:gettext-runtime \
                    path:lib/pkgconfig/glib-2.0.pc:glib2-exp \
                    path:lib/pkgconfig/gobject-introspection-1.0.pc:gobject-introspection \
                    path:lib/pkgconfig/gtk+-3.0.pc:gtk3 \
                    port:libgedit-gtksourceview \
                    port:libpeas \
                    path:bin/vala:vala

patchfiles          patch-python3-bin.diff


post-patch {
    reinplace "s|@@PYTHON3_BIN@@|${configure.python}|" \
        ${worksrcpath}/meson.build
    reinplace "s|^#!.*|#!${configure.python}|" \
        ${worksrcpath}/build-aux/meson/post_install.py
}

# Default Enabled plugins:
#   plugin_bookmarks
#   plugin_bracketcompletion
#   plugin_codecomment
#   plugin_colorpicker
#   plugin_drawspaces
#   plugin_joinlines
#   plugin_multiedit
#   plugin_sessionsaver
#   plugin_smartspaces
#   plugin_wordcompletion
#
# disabled plugins, enabled via variant:
#   charmap
#   terminal

# require C11 compiler
compiler.c_standard   2011

configure.args      -Dplugin_charmap=false \
                    -Dplugin_terminal=false

variant charmap description {Insert special characters just by clicking on them} {
    depends_run-append  port:gucharmap

    configure.args-delete -Dplugin_charmap=false
}

variant terminal description {Embed a GNOME terminal in the bottom panel of the gedit window} {
    depends_run-append  port:vte

    configure.args-delete -Dplugin_terminal=false
}



variant python310 conflicts python311 python312 description {Plugins use Python 3.10} {
    depends_lib-append  port:py310-gobject3 \
                        port:dbus-python310

    configure.python    ${prefix}/bin/python3.10
}

variant python311 conflicts python310 python312 description {Plugins use Python 3.11} {
    depends_lib-append  port:py311-gobject3 \
                        port:dbus-python311

    configure.python    ${prefix}/bin/python3.11
}

variant python312 conflicts python310 python311 description {Plugins use Python 3.12} {
    depends_lib-append  port:py312-gobject3 \
                        port:dbus-python312

    configure.python    ${prefix}/bin/python3.12
}

if {![variant_isset python310] && \
    ![variant_isset python311] && \
    ![variant_isset python312] } {
    default_variants +python312
}

# charmap only ok for x11 build since at the time we only build for quartz
# The line is commented.
#default_variants-append +charmap
# libpeas expects plugin modules with .so extensions
# make .so symlink for each plugin module built as .dylib
post-destroot {
    set plugindir lib/gedit/plugins
    foreach pluginlib {libbookmarks libdrawspaces libfindinfiles libwordcompletion} {
        ln -s ${prefix}/${plugindir}/${pluginlib}.dylib ${destroot}${prefix}/${plugindir}/${pluginlib}.so
    }
}

post-activate {
    system "${prefix}/bin/glib-compile-schemas ${prefix}/share/glib-2.0/schemas"
}

livecheck.type      gnome
