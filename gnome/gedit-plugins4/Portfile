# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           meson 1.0

name                gedit-plugins4
set my_name         gedit-plugins
version             47.1
revision            1
license             GPL-2+
set branch          [join [lrange [split ${version} .] 0 0] .]
description         Plug-ins for GEdit
long_description    Various additional plug-ins for GEdit
maintainers         nomaintainer
categories          gnome editors
platforms           darwin
homepage            https://wiki.gnome.org/Apps/Gedit
master_sites        gnome:sources/${my_name}/${branch}/

use_xz              yes

checksums           rmd160  5c2781f2b6b4d50df6b481e58638c4eda507b178 \
                    sha256  af9d63e5822ac08c68e3b898bb58e7debc1bfeaaca1077f5a8e795d25a164c8b \
                    size    892844

#configure.compiler macports-clang-14

depends_build-append \
                    port:pkgconfig \
                    port:appstream-glib \
                    port:gettext \
                    port:itstool

depends_lib         port:gedit4 \
                    port:gettext \
                    port:gettext-runtime \
                    path:lib/pkgconfig/glib-2.0.pc:glib2 \
                    path:lib/pkgconfig/gobject-introspection-1.0.pc:gobject-introspection \
                    path:lib/pkgconfig/gtk+-3.0.pc:gtk3 \
                    port:libgedit-gtksourceview \
                    port:libpeas \
                    path:bin/vala:vala

#patchfiles          patch-python3-bin.diff \
#                    patch-meson-61.0.diff


#post-patch {
#    reinplace "s|@@PYTHON3_BIN@@|${configure.python}|" \
#        ${worksrcpath}/meson.build
#    reinplace "s|^#!.*|#!${configure.python}|" \
#        ${worksrcpath}/build-aux/meson/post_install.py
#}

# Enabled plugins:
#     bookmarks
#     bracketcompletion
#     codecomment
#     colorpicker
#     colorschemer
#     commander
#     drawspaces
#     findinfiles
#     joinlines
#     multiedit
#     sessionsaver
#     smartspaces
#     textsize
#     translate
#     wordcompletion
#
# disabled plugins, enabled via variant:
#     charmap
#     git
#     synctex
#     terminal

# require C11 compiler
compiler.c_standard   2011

configure.args      -Dplugin_charmap=false \
                    -Dplugin_git=false \
                    -Dplugin_terminal=false

variant charmap description {Insert special characters just by clicking on them} {
    depends_run-append  port:gucharmap

    configure.args-delete -Dplugin_charmap=false
}

variant git description {Highlight lines that have been changed since the last commit} {
    depends_run-append  port:libgit2-glib

    configure.args-delete -Dplugin_git=false
}

variant synctex description {Quickly switch from an opened TeX source file in gedit to a PDF document opened in evince and vice versa} {
    depends_run-append  port:evince

    configure.args-delete -Dplugin_synctex=false
}

variant terminal description {Embed a GNOME terminal in the bottom panel of the gedit window} {
    depends_run-append  port:vte

    configure.args-delete -Dplugin_terminal=false
}



variant python310 conflicts python38 python39 description {Plugins use Python 3.10} {
    depends_lib-append  port:py310-gobject3 \
                        port:dbus-python310

    configure.python    ${prefix}/bin/python3.10
}

variant python311 conflicts python38 python39 description {Plugins use Python 3.11} {
    depends_lib-append  port:py311-gobject3 \
                        port:dbus-python311

    configure.python    ${prefix}/bin/python3.11
}

variant python312 conflicts python38 python39 description {Plugins use Python 3.12} {
    depends_lib-append  port:py312-gobject3 \
                        port:dbus-python312

    configure.python    ${prefix}/bin/python3.12
}

if {![variant_isset python310] && \
    ![variant_isset python311] && \
    ![variant_isset python312] } {
    default_variants +python312
}

default_variants-append +charmap +synctex
# libpeas expects plugin modules with .so extensions
# make .so symlink for each plugin module built as .dylib
post-destroot {
    set plugindir lib/gedit/plugins
    foreach pluginlib {libbookmarks libdrawspaces libfindinfiles libwordcompletion} {
        ln -s ${prefix}/${plugindir}/${pluginlib}.dylib ${destroot}${prefix}/${plugindir}/${pluginlib}.so
    }
}

post-activate {
    system "${prefix}/bin/glib-compile-schemas ${prefix}/share/glib-2.0/schemas"
}

livecheck.type      gnome
